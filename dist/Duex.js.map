{"version":3,"file":"Duex.js","sources":["../src/utils.js","../src/helpers.js","../src/devtool-plugin.js","../src/index.js"],"sourcesContent":["export function normalizeMap(map) {\n    return Array.isArray(map)\n        ? map.map(k => ({ k, v: k }))\n        : Object.keys(map).map(k => ({ k, v: map[k] }))\n}\n\nexport function resolveSource(source, type) {\n    return typeof type === 'function' ? type : source[type]\n}","import { normalizeMap } from './utils'\n\nexport const createMapState = _store => states => {\n    const res = {}\n    for (const { k, v } of normalizeMap(states)) {\n        res[k] = function () {\n            const store = _store || this.$store\n            return typeof v === 'function'\n                ? v.call(this, store.state)\n                : store.state[v]\n        }\n    }\n    return res\n}\n\nexport const mapToMethods = (sourceName, runnerName, _store) => map => {\n    const res = {}\n    for (const { k, v } of normalizeMap(map)) {\n        res[k] = function (payload) {\n            const store = _store || this.$store\n            const source = store[sourceName]\n            const runner = store[runnerName]\n            const actualSource = typeof v === 'function' ? v.call(this, source) : v\n            return runner.call(store, actualSource, payload)\n        }\n    }\n    return res\n}","const devtoolHook =\n    typeof window !== 'undefined' && window.__VUE_DEVTOOLS_GLOBAL_HOOK__\n\nexport default function devtoolPlugin(store) {\n    if (!devtoolHook) return\n\n    store._devtoolHook = devtoolHook\n\n    devtoolHook.emit('vuex:init', store)\n\n    devtoolHook.on('vuex:travel-to-state', targetState => {\n        store.replaceState(targetState)\n    })\n\n    store.subscribe((mutation, state) => {\n        devtoolHook.emit('vuex:mutation', mutation, state)\n    })\n}","import Vue from 'vue'\nimport { resolveSource } from './utils'\nimport { createMapState, mapToMethods } from './helpers'\nimport devtoolPlugin from './devtool-plugin'\n\nexport default class Store {\n    static install(Vue) {\n        Vue.mixin({\n            beforeCreate() {\n                this.$store =\n                    this.$options.store || (this.$parent && this.$parent.$store)\n            }\n        })\n    }\n\n    constructor({\n        state,\n        mutations = {},\n        actions = {},\n        plugins,\n        subscribers = []\n    } = {}) {\n        this.vm = new Vue({\n            data: {\n                $$state: typeof state === 'function' ? state() : state\n            }\n        })\n        this.mutations = mutations\n        this.actions = actions\n        this.subscribers = subscribers\n\n        if (plugins) {\n            plugins.forEach(p => this.use(p))\n        }\n\n        if (Vue.config.devtools) {\n            this.getters = [] // hack for vue-devtools\n            devtoolPlugin(this)\n        }\n\n        this.mapState = createMapState(this)\n        this.mapActions = mapToMethods('actions', 'dispatch', this)\n        this.mapMutations = mapToMethods('mutations', 'commit', this)\n    }\n\n    get state() {\n        return this.vm.$data.$$state\n    }\n\n    set state(v) {\n        if (process.env.NODE_ENV === 'development') {\n            throw new Error(\n                '[puex] store.state is read-only, use store.replaceState(state) instead'\n            )\n        }\n    }\n\n    subscribe(sub) {\n        this.subscribers.push(sub)\n        return () => this.subscribers.splice(this.subscribers.indexOf(sub), 1)\n    }\n\n    commit(type, payload) {\n        const mutation = resolveSource(this.mutations, type)\n        mutation && mutation(this.state, payload)\n        for (const sub of this.subscribers) {\n            sub({ type, payload }, this.state)\n        }\n    }\n\n    dispatch(type, payload) {\n        const action = resolveSource(this.actions, type)\n        const ctx = {\n            dispatch: this.dispatch.bind(this),\n            commit: this.commit.bind(this)\n        }\n        return Promise.resolve(action && action(ctx, payload))\n    }\n\n    use(fn) {\n        fn(this)\n        return this\n    }\n\n    replaceState(state) {\n        this.vm.$data.$$state = state\n        return this\n    }\n}\n\nexport const mapState = createMapState()\nexport const mapActions = mapToMethods('actions', 'dispatch')\nexport const mapMutations = mapToMethods('mutations', 'commit')"],"names":["normalizeMap","map","Array","isArray","k","v","Object","keys","resolveSource","source","type","createMapState","_store","states","res","store","$store","call","state","mapToMethods","sourceName","runnerName","payload","runner","actualSource","devtoolHook","window","__VUE_DEVTOOLS_GLOBAL_HOOK__","devtoolPlugin","_devtoolHook","emit","on","targetState","replaceState","subscribe","mutation","Store","Vue","mixin","beforeCreate","$options","$parent","mutations","actions","plugins","subscribers","vm","data","$$state","forEach","p","use","config","devtools","getters","mapState","mapActions","mapMutations","sub","push","splice","indexOf","action","ctx","dispatch","bind","commit","Promise","resolve","fn","$data","process","env","NODE_ENV","Error"],"mappings":"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"}